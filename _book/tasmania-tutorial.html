<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Tasmania Tutorial | 2021 UQ Spatial Planning Workshop using Prioritizr</title>
  <meta name="description" content="These are the notes for the 2021 UQ Spatial Planning Workshop using Prioritizr." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Tasmania Tutorial | 2021 UQ Spatial Planning Workshop using Prioritizr" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are the notes for the 2021 UQ Spatial Planning Workshop using Prioritizr." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Tasmania Tutorial | 2021 UQ Spatial Planning Workshop using Prioritizr" />
  
  <meta name="twitter:description" content="These are the notes for the 2021 UQ Spatial Planning Workshop using Prioritizr." />
  

<meta name="author" content="Jason D. Everett, Isaac Brito-Morales" />


<meta name="date" content="2021-02-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="running-prioritizr.html"/>
<link rel="next" href="references-1.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">2021 UQ Spatial Planning Workshop using Prioritizr</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> Setting up your computer</a>
<ul>
<li class="chapter" data-level="2.1" data-path="setup.html"><a href="setup.html#r"><i class="fa fa-check"></i><b>2.1</b> R</a></li>
<li class="chapter" data-level="2.2" data-path="setup.html"><a href="setup.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="setup.html"><a href="setup.html#r-packages"><i class="fa fa-check"></i><b>2.3</b> R packages</a></li>
<li class="chapter" data-level="2.4" data-path="setup.html"><a href="setup.html#optimisation-software"><i class="fa fa-check"></i><b>2.4</b> Optimisation Software</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="setup.html"><a href="setup.html#obtaining-a-license"><i class="fa fa-check"></i><b>2.4.1</b> Obtaining a license</a></li>
<li class="chapter" data-level="2.4.2" data-path="setup.html"><a href="setup.html#downloading-the-gurobi-software-suite"><i class="fa fa-check"></i><b>2.4.2</b> Downloading the <em>Gurobi</em> software suite</a></li>
<li class="chapter" data-level="2.4.3" data-path="setup.html"><a href="setup.html#software-installation"><i class="fa fa-check"></i><b>2.4.3</b> Software installation</a></li>
<li class="chapter" data-level="2.4.4" data-path="setup.html"><a href="setup.html#license-activation"><i class="fa fa-check"></i><b>2.4.4</b> License activation</a></li>
<li class="chapter" data-level="2.4.5" data-path="setup.html"><a href="setup.html#local-license-activation"><i class="fa fa-check"></i><b>2.4.5</b> Local license activation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html"><i class="fa fa-check"></i><b>3</b> Overview of the conservation planning problem</a>
<ul>
<li class="chapter" data-level="3.1" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#prioritizr-marxan"><i class="fa fa-check"></i><b>3.1</b> Prioritizr / Marxan</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#algorithm-vs-problem"><i class="fa fa-check"></i><b>3.1.1</b> Algorithm vs Problem</a></li>
<li class="chapter" data-level="3.1.2" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#key-concepts"><i class="fa fa-check"></i><b>3.1.2</b> Key concepts</a></li>
<li class="chapter" data-level="3.1.3" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#minimum-reserve-set-problem"><i class="fa fa-check"></i><b>3.1.3</b> Minimum Reserve Set Problem</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#summary"><i class="fa fa-check"></i><b>3.2</b> Summary</a></li>
<li class="chapter" data-level="3.3" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#introduction"><i class="fa fa-check"></i><b>3.3</b> Introduction</a></li>
<li class="chapter" data-level="3.4" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#package-overview"><i class="fa fa-check"></i><b>3.4</b> Package overview</a></li>
<li class="chapter" data-level="3.5" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#package-work-flow"><i class="fa fa-check"></i><b>3.5</b> Package work flow</a></li>
<li class="chapter" data-level="3.6" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#usage"><i class="fa fa-check"></i><b>3.6</b> Usage</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#data"><i class="fa fa-check"></i><b>3.6.1</b> Data</a></li>
<li class="chapter" data-level="3.6.2" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#initialize-a-problem"><i class="fa fa-check"></i><b>3.6.2</b> Initialize a problem</a></li>
<li class="chapter" data-level="3.6.3" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#add-an-objective"><i class="fa fa-check"></i><b>3.6.3</b> Add an objective</a></li>
<li class="chapter" data-level="3.6.4" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#add-targets"><i class="fa fa-check"></i><b>3.6.4</b> Add targets</a></li>
<li class="chapter" data-level="3.6.5" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#add-constraints"><i class="fa fa-check"></i><b>3.6.5</b> Add constraints</a></li>
<li class="chapter" data-level="3.6.6" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#add-penalties"><i class="fa fa-check"></i><b>3.6.6</b> Add penalties</a></li>
<li class="chapter" data-level="3.6.7" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#add-the-decision-types"><i class="fa fa-check"></i><b>3.6.7</b> Add the decision types</a></li>
<li class="chapter" data-level="3.6.8" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#add-a-solver"><i class="fa fa-check"></i><b>3.6.8</b> Add a solver</a></li>
<li class="chapter" data-level="3.6.9" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#add-a-portfolio"><i class="fa fa-check"></i><b>3.6.9</b> Add a portfolio</a></li>
<li class="chapter" data-level="3.6.10" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#solve-the-problem"><i class="fa fa-check"></i><b>3.6.10</b> Solve the problem</a></li>
<li class="chapter" data-level="3.6.11" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#marxan-problems"><i class="fa fa-check"></i><b>3.6.11</b> <em>Marxan</em> problems</a></li>
<li class="chapter" data-level="3.6.12" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#evaluate-the-performance-of-a-solution"><i class="fa fa-check"></i><b>3.6.12</b> Evaluate the performance of a solution</a></li>
<li class="chapter" data-level="3.6.13" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#importance-irreplaceability"><i class="fa fa-check"></i><b>3.6.13</b> Importance (irreplaceability)</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#conclusion"><i class="fa fa-check"></i><b>3.7</b> Conclusion</a></li>
<li class="chapter" data-level="3.8" data-path="overview-of-the-conservation-planning-problem.html"><a href="overview-of-the-conservation-planning-problem.html#references"><i class="fa fa-check"></i><b>3.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="running-prioritizr.html"><a href="running-prioritizr.html"><i class="fa fa-check"></i><b>4</b> Running Prioritizr</a>
<ul>
<li class="chapter" data-level="4.1" data-path="running-prioritizr.html"><a href="running-prioritizr.html#package-work-flow-1"><i class="fa fa-check"></i><b>4.1</b> Package work flow</a></li>
<li class="chapter" data-level="4.2" data-path="running-prioritizr.html"><a href="running-prioritizr.html#usage-1"><i class="fa fa-check"></i><b>4.2</b> Usage</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="running-prioritizr.html"><a href="running-prioritizr.html#data-1"><i class="fa fa-check"></i><b>4.2.1</b> Data</a></li>
<li class="chapter" data-level="4.2.2" data-path="running-prioritizr.html"><a href="running-prioritizr.html#initialize-a-problem-1"><i class="fa fa-check"></i><b>4.2.2</b> Initialize a problem</a></li>
<li class="chapter" data-level="4.2.3" data-path="running-prioritizr.html"><a href="running-prioritizr.html#add-an-objective-1"><i class="fa fa-check"></i><b>4.2.3</b> Add an objective</a></li>
<li class="chapter" data-level="4.2.4" data-path="running-prioritizr.html"><a href="running-prioritizr.html#add-targets-1"><i class="fa fa-check"></i><b>4.2.4</b> Add targets</a></li>
<li class="chapter" data-level="4.2.5" data-path="running-prioritizr.html"><a href="running-prioritizr.html#add-constraints-1"><i class="fa fa-check"></i><b>4.2.5</b> Add constraints</a></li>
<li class="chapter" data-level="4.2.6" data-path="running-prioritizr.html"><a href="running-prioritizr.html#add-penalties-1"><i class="fa fa-check"></i><b>4.2.6</b> Add penalties</a></li>
<li class="chapter" data-level="4.2.7" data-path="running-prioritizr.html"><a href="running-prioritizr.html#add-the-decision-types-1"><i class="fa fa-check"></i><b>4.2.7</b> Add the decision types</a></li>
<li class="chapter" data-level="4.2.8" data-path="running-prioritizr.html"><a href="running-prioritizr.html#add-a-solver-1"><i class="fa fa-check"></i><b>4.2.8</b> Add a solver</a></li>
<li class="chapter" data-level="4.2.9" data-path="running-prioritizr.html"><a href="running-prioritizr.html#add-a-portfolio-1"><i class="fa fa-check"></i><b>4.2.9</b> Add a portfolio</a></li>
<li class="chapter" data-level="4.2.10" data-path="running-prioritizr.html"><a href="running-prioritizr.html#solve-the-problem-1"><i class="fa fa-check"></i><b>4.2.10</b> Solve the problem</a></li>
<li class="chapter" data-level="4.2.11" data-path="running-prioritizr.html"><a href="running-prioritizr.html#marxan-problems-1"><i class="fa fa-check"></i><b>4.2.11</b> <em>Marxan</em> problems</a></li>
<li class="chapter" data-level="4.2.12" data-path="running-prioritizr.html"><a href="running-prioritizr.html#evaluate-the-performance-of-a-solution-1"><i class="fa fa-check"></i><b>4.2.12</b> Evaluate the performance of a solution</a></li>
<li class="chapter" data-level="4.2.13" data-path="running-prioritizr.html"><a href="running-prioritizr.html#importance-irreplaceability-1"><i class="fa fa-check"></i><b>4.2.13</b> Importance (irreplaceability)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="running-prioritizr.html"><a href="running-prioritizr.html#conclusion-1"><i class="fa fa-check"></i><b>4.3</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tasmania-tutorial.html"><a href="tasmania-tutorial.html"><i class="fa fa-check"></i><b>5</b> Tasmania Tutorial</a>
<ul>
<li class="chapter" data-level="5.1" data-path="tasmania-tutorial.html"><a href="tasmania-tutorial.html#exploring-the-data"><i class="fa fa-check"></i><b>5.1</b> Exploring the data</a></li>
<li class="chapter" data-level="5.2" data-path="tasmania-tutorial.html"><a href="tasmania-tutorial.html#marxan-problem-formulation"><i class="fa fa-check"></i><b>5.2</b> <em>Marxan</em> problem formulation</a></li>
<li class="chapter" data-level="5.3" data-path="tasmania-tutorial.html"><a href="tasmania-tutorial.html#general-problem-formulation"><i class="fa fa-check"></i><b>5.3</b> General problem formulation</a></li>
<li class="chapter" data-level="5.4" data-path="tasmania-tutorial.html"><a href="tasmania-tutorial.html#selection-frequencies"><i class="fa fa-check"></i><b>5.4</b> Selection frequencies</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">2021 UQ Spatial Planning Workshop using Prioritizr</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tasmania-tutorial" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Tasmania Tutorial</h1>
<p>The aim of this tutorial is to provide a worked example of how vector-based data can be used to develop conservation prioritizations using the <em>prioritizr R</em> package. It is also written for conservation planners that have used the <em>Marxan</em> decision support tool <span class="citation">(<a href="references-1.html#ref-r3" role="doc-biblioref">Ball <em>et al.</em> 2009</a>)</span> and are interested in applying the <em>prioritizr R</em> package to their own work. The dataset used in this tutorial was obtained from the <em>Introduction to Marxan</em> course. This data was originally a subset of a larger spatial prioritization project performed under contract to Australia’s Department of Environment and Water Resources <span class="citation">(<a href="references-1.html#ref-r30" role="doc-biblioref">Klein <em>et al.</em> 2007</a>)</span>.</p>
<p>Please note that this tutorial uses data from the <em>prioritizrdata R</em>, so ensure that it is installed before trying out the code yourself.</p>
<div id="exploring-the-data" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Exploring the data</h2>
<p>This dataset contains two items. First, a spatial planning unit layer that has an attribute table which contains three columns: integer unique identifiers (“id”), unimproved land values (“cost”), and their existing level of protection (“status”). Units with 50 % or more of their area contained in protected areas are associated with a status of 2, otherwise they are associated with a value of 0. If you are familiar with the <em>Marxan</em> decision support tool, then you will notice that these columns are formatted in a similar manner to the input data for <em>Marxan</em>. For <em>Marxan</em> input data, planning units must be described in a table containing one row for each planning unit with a unique identifier and the corresponding cost.</p>
<p>The second item in this dataset is the raster-based feature data. Specifically, the feature data is expressed as a stack of rasters (termed a <code>RasterStack</code> object). Here each layer in the stack represents the distribution of a different vegetation class in Tasmania, Australia. There are 62 vegetation classes in total. For a given layer, pixel values indicate the presence (value of 1) or absence (value of 0) of the vegetation class in an area.</p>
<p>First, load the required packages and the data.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="tasmania-tutorial.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb241-2"><a href="tasmania-tutorial.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prioritizrdata)</span>
<span id="cb241-3"><a href="tasmania-tutorial.html#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prioritizr)</span>
<span id="cb241-4"><a href="tasmania-tutorial.html#cb241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-5"><a href="tasmania-tutorial.html#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="co"># load planning unit data</span></span>
<span id="cb241-6"><a href="tasmania-tutorial.html#cb241-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(tas_pu)</span>
<span id="cb241-7"><a href="tasmania-tutorial.html#cb241-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-8"><a href="tasmania-tutorial.html#cb241-8" aria-hidden="true" tabindex="-1"></a><span class="co"># load conservation feature data</span></span>
<span id="cb241-9"><a href="tasmania-tutorial.html#cb241-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(tas_features)</span></code></pre></div>
<p>Now, let’s have a look at the planning unit data.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="tasmania-tutorial.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print planning unit data</span></span>
<span id="cb242-2"><a href="tasmania-tutorial.html#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tas_pu)</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1130 
## extent      : 298809.6, 613818.8, 5167775, 5502544  (xmin, xmax, ymin, ymax)
## crs         : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## variables   : 5
## names       :   id,              cost, status, locked_in, locked_out 
## min values  :    1, 0.192488262910798,      0,         0,          0 
## max values  : 1130,  61.9272727272727,      2,         1,          0</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="tasmania-tutorial.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot map of planning unit costs</span></span>
<span id="cb244-2"><a href="tasmania-tutorial.html#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_as_sf</span>(tas_pu[, <span class="st">&quot;cost&quot;</span>]), <span class="at">main =</span> <span class="st">&quot;Planning unit costs&quot;</span>)</span></code></pre></div>
<p><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-114-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Next, let examine the feature data. Here we will only plot the first four features as an example. The pixel values denote the presence or absence of each feature within the extent of the study area.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="tasmania-tutorial.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print planning unit data</span></span>
<span id="cb245-2"><a href="tasmania-tutorial.html#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tas_features)</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 398, 359, 142882, 62  (nrow, ncol, ncell, nlayers)
## resolution : 1000, 1000  (x, y)
## extent     : 288801.7, 647801.7, 5142976, 5540976  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=55 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names      : tas_features.1, tas_features.2, tas_features.3, tas_features.4, tas_features.5, tas_features.6, tas_features.7, tas_features.8, tas_features.9, tas_features.10, tas_features.11, tas_features.12, tas_features.13, tas_features.14, tas_features.15, ... 
## min values :              0,              0,              0,              0,              0,              0,              0,              0,              0,               0,               0,               0,               0,               0,               0, ... 
## max values :              1,              1,              1,              1,              1,              1,              1,              1,              1,               1,               1,               1,               1,               1,               1, ...</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="tasmania-tutorial.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot map of the first four vegetation classes</span></span>
<span id="cb247-2"><a href="tasmania-tutorial.html#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tas_features[[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]], <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Feature&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span></code></pre></div>
<p><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-115-1.png" width="432" style="display: block; margin: auto;" /></p>
<p>The planning units in this example are a spatial polygon layer—not a raster—and so there can be considerable flexibility in the shape of the planning units. That said, there is a trade-off with the efficiency of data pre-processing in vector-based planning unit data compared to raster-based planning unit data. Vector-based planning unit data generally require more time to complete pre-processing computations (e.g. overlaying the planning unit data with the feature data, or generating boundary data). As a consequence, we generally recommend using raster-based planning unit data where possible to reduce processing time—but note that this is not possible when not all planning units are equal-sized squares. Another strategy is to complete the pre-processing in other software environments (e.g. <em>ArcGIS</em>) and use the pre-processed data directly with the <em>prioritizr</em> package.</p>
</div>
<div id="marxan-problem-formulation" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> <em>Marxan</em> problem formulation</h2>
<p>Here, we will provide an example of using the <code>marxan_problem</code> function to build and solve a typical <em>Marxan</em> conservation planning problem. Then we will show how this same problem can be built and solved using the fully customizable <code>problem</code> function as a comparison.</p>
<p>The dataset used in this example follows many of the conventions used by the <em>Marxan</em> decision support tool. As a consequence, it is not too difficult to format the data for use with the <code>marxan_problem</code> function. The <code>marxan_problem</code> function is essentially a wrapper to the <code>problem</code> function. This means that when we solve problems created using the <code>marxan_problem</code> function, we will solve them using exact algorithms and not the simulated annealing algorithm used by <em>Marxan</em>.</p>
<p>All problem objects formulated with <code>marxan_problem</code> use the minimum set objective. Targets can be either relative or absolute, and planning units can be specified for masking in or out using the <code>locked_in</code> and <code>locked_out</code> arguments. To favor clumped solutions, use the <code>penalty</code> argument to impose a penalty on solutions with high boundary lengths (equivalent to the Boundary Length Modifier (BLM) used in <em>Marxan</em>), and the <code>edge_factor</code> argument to scale the penalty for edges that do not have neighboring planning units, such as the coastline. For simplicity we set all of the targets at the same level, 17 %, to reflect the <a href="https://www.cbd.int/sp/targets/">Aichi</a> biodiversity target to “safeguard” at least 17% of terrestrial ecosystems by 2020. For example, to prioritize planning units in Tasmania that meet the 17 % representation target at the least cost.</p>
<p>First, we will convert the vector-based planning unit data and raster-based feature data into the tabular formats required by the <code>marxan_problem</code> function. These formats are very similar to the formats used by <em>Marxan</em>.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="tasmania-tutorial.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create table with planning unit data</span></span>
<span id="cb248-2"><a href="tasmania-tutorial.html#cb248-2" aria-hidden="true" tabindex="-1"></a>pu_data <span class="ot">&lt;-</span> tas_pu<span class="sc">@</span>data</span>
<span id="cb248-3"><a href="tasmania-tutorial.html#cb248-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-4"><a href="tasmania-tutorial.html#cb248-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print first six rows</span></span>
<span id="cb248-5"><a href="tasmania-tutorial.html#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pu_data)</span></code></pre></div>
<pre><code>##   id     cost status locked_in locked_out
## 0  1 60.24638      0     FALSE      FALSE
## 1  2 19.86301      0     FALSE      FALSE
## 2  3 59.68051      0     FALSE      FALSE
## 3  4 32.41614      0     FALSE      FALSE
## 4  5 26.17706      0     FALSE      FALSE
## 5  6 51.26218      0     FALSE      FALSE</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="tasmania-tutorial.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create table with the feature identifiers, names, and targets</span></span>
<span id="cb250-2"><a href="tasmania-tutorial.html#cb250-2" aria-hidden="true" tabindex="-1"></a>spec_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id =</span> <span class="fu">seq_len</span>(<span class="fu">nlayers</span>(tas_features)),</span>
<span id="cb250-3"><a href="tasmania-tutorial.html#cb250-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;veg&quot;</span>, <span class="fu">seq_len</span>(<span class="fu">nlayers</span>(tas_features))),</span>
<span id="cb250-4"><a href="tasmania-tutorial.html#cb250-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prop =</span> <span class="fl">0.17</span>)</span>
<span id="cb250-5"><a href="tasmania-tutorial.html#cb250-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-6"><a href="tasmania-tutorial.html#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print first six rows</span></span>
<span id="cb250-7"><a href="tasmania-tutorial.html#cb250-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spec_data)</span></code></pre></div>
<pre><code>##   id name prop
## 1  1 veg1 0.17
## 2  2 veg2 0.17
## 3  3 veg3 0.17
## 4  4 veg4 0.17
## 5  5 veg5 0.17
## 6  6 veg6 0.17</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="tasmania-tutorial.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create table with the planning unit vs. feature data</span></span>
<span id="cb252-2"><a href="tasmania-tutorial.html#cb252-2" aria-hidden="true" tabindex="-1"></a>puvspr_data <span class="ot">&lt;-</span> <span class="fu">rij_matrix</span>(tas_pu, tas_features)</span>
<span id="cb252-3"><a href="tasmania-tutorial.html#cb252-3" aria-hidden="true" tabindex="-1"></a>puvspr_data <span class="ot">&lt;-</span> <span class="fu">as</span>(puvspr_data, <span class="st">&quot;dgTMatrix&quot;</span>)</span>
<span id="cb252-4"><a href="tasmania-tutorial.html#cb252-4" aria-hidden="true" tabindex="-1"></a>puvspr_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pu =</span> puvspr_data<span class="sc">@</span>j <span class="sc">+</span> <span class="dv">1</span>, <span class="at">species =</span> puvspr_data<span class="sc">@</span>i <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb252-5"><a href="tasmania-tutorial.html#cb252-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">amount =</span> puvspr_data<span class="sc">@</span>x)</span>
<span id="cb252-6"><a href="tasmania-tutorial.html#cb252-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-7"><a href="tasmania-tutorial.html#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print first six rows</span></span>
<span id="cb252-8"><a href="tasmania-tutorial.html#cb252-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(puvspr_data)</span></code></pre></div>
<pre><code>##   pu species       amount
## 1  3      54 1.000000e+00
## 2  3      59 1.165971e+01
## 3  5      30 1.000000e+00
## 4  6      27 1.000000e+00
## 5  6      35 1.000000e+00
## 6  6      59 3.635182e-05</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="tasmania-tutorial.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create table with the boundary data</span></span>
<span id="cb254-2"><a href="tasmania-tutorial.html#cb254-2" aria-hidden="true" tabindex="-1"></a>bound_data <span class="ot">&lt;-</span> <span class="fu">boundary_matrix</span>(tas_pu)</span>
<span id="cb254-3"><a href="tasmania-tutorial.html#cb254-3" aria-hidden="true" tabindex="-1"></a>bound_data <span class="ot">&lt;-</span> <span class="fu">as</span>(bound_data, <span class="st">&quot;dgTMatrix&quot;</span>)</span>
<span id="cb254-4"><a href="tasmania-tutorial.html#cb254-4" aria-hidden="true" tabindex="-1"></a>bound_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">id1 =</span> bound_data<span class="sc">@</span>i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">id2 =</span> bound_data<span class="sc">@</span>j <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb254-5"><a href="tasmania-tutorial.html#cb254-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">boundary =</span> bound_data<span class="sc">@</span>x)</span>
<span id="cb254-6"><a href="tasmania-tutorial.html#cb254-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print first six rows</span></span>
<span id="cb254-7"><a href="tasmania-tutorial.html#cb254-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bound_data)</span></code></pre></div>
<pre><code>##   id1 id2   boundary
## 1   1   1  6314.6621
## 2   3   1  3922.9264
## 3   6   1   150.3778
## 4   2   2 23958.6982
## 5   4   2  3233.3056
## 6   7   2  4639.9220</code></pre>
<p>Now that we have converted the data to tabular format, we can use the <code>marxan_problem</code> function to create a conservation planning problem.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="tasmania-tutorial.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create problem</span></span>
<span id="cb256-2"><a href="tasmania-tutorial.html#cb256-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">marxan_problem</span>(pu_data, spec_data, puvspr_data, bound_data,</span>
<span id="cb256-3"><a href="tasmania-tutorial.html#cb256-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">blm =</span> <span class="fl">0.0005</span>)</span>
<span id="cb256-4"><a href="tasmania-tutorial.html#cb256-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-5"><a href="tasmania-tutorial.html#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print problem</span></span>
<span id="cb256-6"><a href="tasmania-tutorial.html#cb256-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p1)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: data.frame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       veg1, veg2, veg3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      default
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 1, max: 1), penalty (5e-04), zones]&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<p>Next, we can solve the problem (see <a href="https://prioritizr.net/reference/solve.html"><code>?solve</code></a> for more information). The <em>prioritizr</em> R package supports three different exact algorithm software packages: <em>gurobi</em>, <em>Rsymphony</em>, and <em>lpsymphony</em>. There are costs and benefits associated with each of these different solvers, but each software should return similar results. Note that you will need at least one of these package installed on your system to solve problems. We recommend using the <em>gurobi</em> solver if possible, and have used this solver when building this tutorial. After solving the problem, we will calculate some statistics to describe the solution. Note that the planning unit selections are stored in the “solution_1” column of the solution object.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="tasmania-tutorial.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solve problem</span></span>
<span id="cb258-2"><a href="tasmania-tutorial.html#cb258-2" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">solve</span>(p1)</span></code></pre></div>
<pre><code>## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 6358 rows, 4278 columns and 14496 nonzeros
## Model fingerprint: 0xa2fb0a5e
## Variable types: 0 continuous, 4278 integer (4278 binary)
## Coefficient statistics:
##   Matrix range     [2e-06, 4e+01]
##   Objective range  [5e-02, 2e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e-01, 1e+02]
## Found heuristic solution: objective 30263.129158
## Found heuristic solution: objective 12512.071934
## Presolve removed 1793 rows and 1168 columns
## Presolve time: 0.03s
## Presolved: 4565 rows, 3110 columns, 10169 nonzeros
## Found heuristic solution: objective 11803.383927
## Variable types: 0 continuous, 3110 integer (3110 binary)
## Presolved: 4565 rows, 3110 columns, 10169 nonzeros
## 
## 
## Root relaxation: objective 1.076817e+04, 808 iterations, 0.04 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 10768.1736    0  137 11803.3839 10768.1736  8.77%     -    0s
## 
## Explored 0 nodes (808 simplex iterations) in 0.10 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 3: 11803.4 12512.1 30263.1 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.180338392702e+04, best bound 1.076817364956e+04, gap 8.7705%</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="tasmania-tutorial.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print first six rows of solution object</span></span>
<span id="cb260-2"><a href="tasmania-tutorial.html#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s1)</span></code></pre></div>
<pre><code>##   id     cost status locked_in locked_out solution_1
## 0  1 60.24638      0     FALSE      FALSE          0
## 1  2 19.86301      0     FALSE      FALSE          0
## 2  3 59.68051      0     FALSE      FALSE          0
## 3  4 32.41614      0     FALSE      FALSE          0
## 4  5 26.17706      0     FALSE      FALSE          0
## 5  6 51.26218      0     FALSE      FALSE          0</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="tasmania-tutorial.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count number of planning units in solution</span></span>
<span id="cb262-2"><a href="tasmania-tutorial.html#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(s1<span class="sc">$</span>solution_1)</span></code></pre></div>
<pre><code>## [1] 326</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="tasmania-tutorial.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportion of planning units in solution</span></span>
<span id="cb264-2"><a href="tasmania-tutorial.html#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(s1<span class="sc">$</span>solution_1)</span></code></pre></div>
<pre><code>## [1] 0.2884956</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="tasmania-tutorial.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate feature representation</span></span>
<span id="cb266-2"><a href="tasmania-tutorial.html#cb266-2" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">eval_feature_representation_summary</span>(p1, s1[, <span class="st">&quot;solution_1&quot;</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb266-3"><a href="tasmania-tutorial.html#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(r1)</span></code></pre></div>
<pre><code>## # A tibble: 62 x 5
##    summary feature total_amount absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
##  1 overall veg1            33.9          5.97         0.176
##  2 overall veg2           170.          40.7          0.239
##  3 overall veg3            24.0          6.00         0.250
##  4 overall veg4            32.8         10.4          0.317
##  5 overall veg5            24.8          4.51         0.182
##  6 overall veg6            22.0          4.00         0.182
##  7 overall veg7            16.4          3.06         0.187
##  8 overall veg8            43.0          9.12         0.212
##  9 overall veg9           388.          95.3          0.245
## 10 overall veg10           14.5          5.91         0.407
## # … with 52 more rows</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="tasmania-tutorial.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the solution by converting the solution to a spatial object</span></span>
<span id="cb268-2"><a href="tasmania-tutorial.html#cb268-2" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">SpatialPolygonsDataFrame</span>(<span class="fu">as</span>(tas_pu, <span class="st">&quot;SpatialPolygons&quot;</span>), <span class="at">data =</span> s1)</span>
<span id="cb268-3"><a href="tasmania-tutorial.html#cb268-3" aria-hidden="true" tabindex="-1"></a>s1<span class="sc">$</span>solution_1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(s1<span class="sc">$</span>solution_1)</span>
<span id="cb268-4"><a href="tasmania-tutorial.html#cb268-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_as_sf</span>(s1[, <span class="st">&quot;solution_1&quot;</span>]), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">&quot;grey90&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>),</span>
<span id="cb268-5"><a href="tasmania-tutorial.html#cb268-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;marxan_problem solution&quot;</span>)</span></code></pre></div>
<p><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-118-1.png" width="336" style="display: block; margin: auto;" /></p>
</div>
<div id="general-problem-formulation" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> General problem formulation</h2>
<p>Now we will formulate the exact same problem using the <code>problem</code> function and the spatially referenced data. We recommend using this approach instead of the <code>marxan_problem</code> because it is more verbose and you can specify exactly how the conservation planning problem should be formulated.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="tasmania-tutorial.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build problem</span></span>
<span id="cb269-2"><a href="tasmania-tutorial.html#cb269-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">problem</span>(tas_pu, tas_features, <span class="at">cost_column =</span> <span class="st">&quot;cost&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb269-3"><a href="tasmania-tutorial.html#cb269-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_min_set_objective</span>() <span class="sc">%&gt;%</span></span>
<span id="cb269-4"><a href="tasmania-tutorial.html#cb269-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_relative_targets</span>(<span class="fl">0.17</span>) <span class="sc">%&gt;%</span></span>
<span id="cb269-5"><a href="tasmania-tutorial.html#cb269-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_locked_in_constraints</span>(<span class="st">&quot;locked_in&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb269-6"><a href="tasmania-tutorial.html#cb269-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_binary_decisions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb269-7"><a href="tasmania-tutorial.html#cb269-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_boundary_penalties</span>(<span class="at">penalty =</span> <span class="fl">0.0005</span>, <span class="at">edge_factor =</span> <span class="dv">1</span>)</span>
<span id="cb269-8"><a href="tasmania-tutorial.html#cb269-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-9"><a href="tasmania-tutorial.html#cb269-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print the problem</span></span>
<span id="cb269-10"><a href="tasmania-tutorial.html#cb269-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       tas_features.1, tas_features.2, tas_features.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 1, max: 1), penalty (5e-04), zones]&gt;
##   portfolio:      default
##   solver:         default</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="tasmania-tutorial.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># solve problem</span></span>
<span id="cb271-2"><a href="tasmania-tutorial.html#cb271-2" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">solve</span>(p2)</span></code></pre></div>
<pre><code>## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 6358 rows, 4278 columns and 14496 nonzeros
## Model fingerprint: 0xa2fb0a5e
## Variable types: 0 continuous, 4278 integer (4278 binary)
## Coefficient statistics:
##   Matrix range     [2e-06, 4e+01]
##   Objective range  [5e-02, 2e+02]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [1e-01, 1e+02]
## Found heuristic solution: objective 30263.129158
## Found heuristic solution: objective 12512.071934
## Presolve removed 1793 rows and 1168 columns
## Presolve time: 0.03s
## Presolved: 4565 rows, 3110 columns, 10169 nonzeros
## Found heuristic solution: objective 11803.383927
## Variable types: 0 continuous, 3110 integer (3110 binary)
## Presolved: 4565 rows, 3110 columns, 10169 nonzeros
## 
## 
## Root relaxation: objective 1.076817e+04, 808 iterations, 0.04 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0 10768.1736    0  137 11803.3839 10768.1736  8.77%     -    0s
## 
## Explored 0 nodes (808 simplex iterations) in 0.09 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 3: 11803.4 12512.1 30263.1 
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.180338392702e+04, best bound 1.076817364956e+04, gap 8.7705%</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="tasmania-tutorial.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate feature representation</span></span>
<span id="cb273-2"><a href="tasmania-tutorial.html#cb273-2" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">eval_feature_representation_summary</span>(p2, s2[, <span class="st">&quot;solution_1&quot;</span>])</span>
<span id="cb273-3"><a href="tasmania-tutorial.html#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(r2)</span></code></pre></div>
<pre><code>## # A tibble: 62 x 5
##    summary feature         total_amount absolute_held relative_held
##    &lt;chr&gt;   &lt;chr&gt;                  &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
##  1 overall tas_features.1          33.9          5.97         0.176
##  2 overall tas_features.2         170.          40.7          0.239
##  3 overall tas_features.3          24.0          6.00         0.250
##  4 overall tas_features.4          32.8         10.4          0.317
##  5 overall tas_features.5          24.8          4.51         0.182
##  6 overall tas_features.6          22.0          4.00         0.182
##  7 overall tas_features.7          16.4          3.06         0.187
##  8 overall tas_features.8          43.0          9.12         0.212
##  9 overall tas_features.9         388.          95.3          0.245
## 10 overall tas_features.10         14.5          5.91         0.407
## # … with 52 more rows</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="tasmania-tutorial.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize solution</span></span>
<span id="cb275-2"><a href="tasmania-tutorial.html#cb275-2" aria-hidden="true" tabindex="-1"></a>s2<span class="sc">$</span>solution_1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(s2<span class="sc">$</span>solution_1)</span>
<span id="cb275-3"><a href="tasmania-tutorial.html#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_as_sf</span>(s2[, <span class="st">&quot;solution_1&quot;</span>]), <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">&quot;grey90&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>),</span>
<span id="cb275-4"><a href="tasmania-tutorial.html#cb275-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;problem solution&quot;</span>)</span></code></pre></div>
<p><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-119-1.png" width="336" style="display: block; margin: auto;" /></p>
</div>
<div id="selection-frequencies" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Selection frequencies</h2>
<p>Similar to the <em>Marxan</em> decision support tool, we can generate a portfolio of solutions and compute the planning unit selection frequencies to understand their relative importance. This can be useful when trying to understand which planning units in the solution are the most irreplaceable. To do this, we will create a portfolio containing 1000 solutions within 20% of optimality, and calculate the number of times that each planning unit was selected. Note that this requires the <em>Gurobi</em> software to be installed.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="tasmania-tutorial.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create new problem with a portfolio added to it</span></span>
<span id="cb276-2"><a href="tasmania-tutorial.html#cb276-2" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> p2 <span class="sc">%&gt;%</span></span>
<span id="cb276-3"><a href="tasmania-tutorial.html#cb276-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_gap_portfolio</span>(<span class="at">number_solutions =</span> <span class="dv">1000</span>, <span class="at">pool_gap =</span> <span class="fl">0.2</span>)</span>
<span id="cb276-4"><a href="tasmania-tutorial.html#cb276-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-5"><a href="tasmania-tutorial.html#cb276-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print problem</span></span>
<span id="cb276-6"><a href="tasmania-tutorial.html#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p3)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       tas_features.1, tas_features.2, tas_features.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.17, max: 0.17)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 1, max: 1), penalty (5e-04), zones]&gt;
##   portfolio:      Gap portfolio [number_solutions (1000), pool_gap (0.2)]
##   solver:         default</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="tasmania-tutorial.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate solutions</span></span>
<span id="cb278-2"><a href="tasmania-tutorial.html#cb278-2" aria-hidden="true" tabindex="-1"></a>s3 <span class="ot">&lt;-</span> <span class="fu">solve</span>(p3)</span>
<span id="cb278-3"><a href="tasmania-tutorial.html#cb278-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-4"><a href="tasmania-tutorial.html#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="co"># find column numbers with the solutions</span></span>
<span id="cb278-5"><a href="tasmania-tutorial.html#cb278-5" aria-hidden="true" tabindex="-1"></a>solution_columns <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">grepl</span>(<span class="st">&quot;solution&quot;</span>, <span class="fu">names</span>(s3)))</span>
<span id="cb278-6"><a href="tasmania-tutorial.html#cb278-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-7"><a href="tasmania-tutorial.html#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate selection frequencies</span></span>
<span id="cb278-8"><a href="tasmania-tutorial.html#cb278-8" aria-hidden="true" tabindex="-1"></a>s3<span class="sc">$</span>selection_frequencies <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(s3<span class="sc">@</span>data[, solution_columns]))</span></code></pre></div>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="tasmania-tutorial.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot first four solutions in the portfolio</span></span>
<span id="cb279-2"><a href="tasmania-tutorial.html#cb279-2" aria-hidden="true" tabindex="-1"></a>s3<span class="sc">$</span>solution_1 <span class="ot">&lt;-</span> <span class="fu">factor</span>(s3<span class="sc">$</span>solution_1)</span>
<span id="cb279-3"><a href="tasmania-tutorial.html#cb279-3" aria-hidden="true" tabindex="-1"></a>s3<span class="sc">$</span>solution_2 <span class="ot">&lt;-</span> <span class="fu">factor</span>(s3<span class="sc">$</span>solution_2)</span>
<span id="cb279-4"><a href="tasmania-tutorial.html#cb279-4" aria-hidden="true" tabindex="-1"></a>s3<span class="sc">$</span>solution_3 <span class="ot">&lt;-</span> <span class="fu">factor</span>(s3<span class="sc">$</span>solution_3)</span>
<span id="cb279-5"><a href="tasmania-tutorial.html#cb279-5" aria-hidden="true" tabindex="-1"></a>s3<span class="sc">$</span>solution_4 <span class="ot">&lt;-</span> <span class="fu">factor</span>(s3<span class="sc">$</span>solution_4)</span>
<span id="cb279-6"><a href="tasmania-tutorial.html#cb279-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_as_sf</span>(s3[, <span class="fu">c</span>(<span class="st">&quot;solution_1&quot;</span>, <span class="st">&quot;solution_2&quot;</span>, <span class="st">&quot;solution_3&quot;</span>, <span class="st">&quot;solution_4&quot;</span>)]),</span>
<span id="cb279-7"><a href="tasmania-tutorial.html#cb279-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">c</span>(<span class="st">&quot;grey90&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>))</span></code></pre></div>
<p><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-122-1.png" width="432" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="tasmania-tutorial.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot histogram of selection frequencies</span></span>
<span id="cb280-2"><a href="tasmania-tutorial.html#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(s3<span class="sc">$</span>selection_frequencies, <span class="at">main =</span> <span class="st">&quot;Selection frequencies&quot;</span>,</span>
<span id="cb280-3"><a href="tasmania-tutorial.html#cb280-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Number of times units were selected&quot;</span>)</span></code></pre></div>
<p><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-123-1.png" width="336" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="tasmania-tutorial.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spatial distribution of the selection frequencies</span></span>
<span id="cb281-2"><a href="tasmania-tutorial.html#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_as_sf</span>(s3[, <span class="st">&quot;selection_frequencies&quot;</span>]), <span class="at">main =</span> <span class="st">&quot;Selection frequencies&quot;</span>)</span></code></pre></div>
<p><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-123-2.png" width="336" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="running-prioritizr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SpatialPlanning_Workshop2021.pdf", "SpatialPlanning_Workshop2021.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
