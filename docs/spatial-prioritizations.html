<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Spatial prioritizations | 2021 UQ Spatial Planning Workshop using Prioritizr</title>
<meta name="author" content="Jason D. Everett, Isaac Brito-Morales">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">2021 UQ Spatial Planning Workshop using Prioritizr</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="setup.html"><span class="header-section-number">2</span> Setting up your computer</a></li>
<li><a class="" href="overview-of-the-conservation-planning-problem.html"><span class="header-section-number">3</span> Overview of the conservation planning problem</a></li>
<li><a class="" href="getting-started-with-prioritizr.html"><span class="header-section-number">4</span> Getting Started with Prioritizr</a></li>
<li><a class="" href="data.html"><span class="header-section-number">5</span> Spatial Data</a></li>
<li><a class="active" href="spatial-prioritizations.html"><span class="header-section-number">6</span> Spatial prioritizations</a></li>
<li><a class="" href="acknowledgements.html"><span class="header-section-number">7</span> Acknowledgements</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="spatial-prioritizations" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Spatial prioritizations<a class="anchor" aria-label="anchor" href="#spatial-prioritizations"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-1" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>Here we will develop prioritizations to identify priority areas for protected area establishment.</p>
</div>
<div id="starting-out-simple" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Starting out simple<a class="anchor" aria-label="anchor" href="#starting-out-simple"><i class="fas fa-link"></i></a>
</h2>
<p>To start things off, let’s keep things simple. Let’s create a prioritization using the <a href="https://prioritizr.net/reference/add_min_set_objective.html">minimum set formulation of the reserve selection problem</a>. This formulation means that <strong>we want a solution that will meet the targets for our biodiversity features for minimum cost</strong>. Here, we will set 5% targets for each vegetation class and use the data in the <code>cost</code> column to specify acquisition costs. Unlike Marxan, we do not have to calibrate species penalty factors (SPFs) to ensure that our target are met—prioritizr should always return solutions to minimum set problems where all the targets are met.</p>
<p>Although we strongly recommend using <a href="https://www.gurobi.com/">Gurobi</a> to solve problems (with <a href="https://prioritizr.net/reference/add_gurobi_solver.html"><code>add_gurobi_solver</code></a>), you can also use the <a href="https://prioritizr.net/reference/add_lsymphony_solver.html">lpsymphony solver</a> in this workshop (it’s much easier to install). The Gurobi solver is much faster than the lpsymphony solver (<a href="https://prioritizr.net/articles/gurobi_installation.html">see here for installation instructions</a>).</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print planning unit data</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">tas_pu</span><span class="op">)</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1130 
## extent      : 1080623, 1399989, -4840595, -4497092  (xmin, xmax, ymin, ymax)
## crs         : +proj=aea +lat_0=0 +lon_0=132 +lat_1=-18 +lat_2=-36 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## variables   : 5
## names       :   id,              cost, status, locked_in, locked_out 
## min values  :    1, 0.192488262910798,      0,         0,          0 
## max values  : 1130,  61.9272727272727,      2,         1,          1</code></pre>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make prioritization problem</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># 5% representation targets</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = FALSE)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.05, max: 0.05)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (0)]</code></pre>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem</span>
<span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span>

<span class="co"># print solution, the solution_1 column contains the solution values</span>
<span class="co"># indicating if a planning unit is (1) selected or (0) not</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1130 
## extent      : 1080623, 1399989, -4840595, -4497092  (xmin, xmax, ymin, ymax)
## crs         : +proj=aea +lat_0=0 +lon_0=132 +lat_1=-18 +lat_2=-36 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## variables   : 6
## names       :   id,              cost, status, locked_in, locked_out, solution_1 
## min values  :    1, 0.192488262910798,      0,         0,          0,          0 
## max values  : 1130,  61.9272727272727,      2,         1,          1,          1</code></pre>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate number of planning units selected in the prioritization</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">s1</span><span class="op">$</span><span class="va">solution_1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate total cost of the prioritization</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">s1</span><span class="op">$</span><span class="va">solution_1</span> <span class="op">*</span> <span class="va">s1</span><span class="op">$</span><span class="va">cost</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 808.4013</code></pre>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot solution</span>
<span class="fu">plot_solution</span><span class="op">(</span><span class="va">s1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-69-1.png" width="65%" style="display: block; margin: auto;"></div>
<p>Now let’s examine the solution.</p>

<div class="rmdquestion">
<ol style="list-style-type: decimal">
<li>How many planing units were selected in the prioritization? What proportion of planning units were selected in the prioritization?</li>
<li>Is there a pattern in the spatial distribution of the priority areas?</li>
<li>Can you verify that all of the targets were met in the prioritization (hint: <code><a href="https://prioritizr.net/reference/prioritizr-deprecated.html">feature_representation(p1, s1[, "solution_1"])</a></code>)?</li>
</ol>
</div>
</div>
<div id="adding-complexity" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Adding complexity<a class="anchor" aria-label="anchor" href="#adding-complexity"><i class="fas fa-link"></i></a>
</h2>
<p>Our first prioritization suffers many limitations, so let’s add additional constraints to the problem to make it more useful.</p>
<p>First, let’s lock in planing units that are already by covered protected areas. If some vegetation communities are already secured inside existing protected areas, then we might not need to add as many new protected areas to the existing protected area system to meet their targets. Since our planning unit data (<code>tas_pu</code>) already contains this information in the <code>locked_in</code> column, we can use this column name to specify which planning units should be locked in.</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make prioritization problem</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = FALSE)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.05, max: 0.05)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (0)]</code></pre>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem</span>
<span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span>

<span class="co"># plot solution</span>
<span class="fu">plot_solution</span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-71-1.png" width="65%" style="display: block; margin: auto;"></div>
<p>Let’s pretend that we talked to an expert on the vegetation communities in our study system and they recommended that a 20% target was needed for each vegetation class. So, armed with this information, let’s set the targets to 20%.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make prioritization problem</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = FALSE)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.2, max: 0.2)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (0)]</code></pre>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem</span>
<span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span>

<span class="co"># plot solution</span>
<span class="fu">plot_solution</span><span class="op">(</span><span class="va">s3</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-72-1.png" width="65%" style="display: block; margin: auto;"></div>
<p>Next, let’s lock out highly degraded areas. Similar to before, this data is present in our planning unit data so we can use the <code>locked_out</code> column name to achieve this.</p>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make prioritization problem</span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_out_constraints.html">add_locked_out_constraints</a></span><span class="op">(</span><span class="st">"locked_out"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = FALSE)</span></code></pre></div>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.2, max: 0.2)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]
##                    Locked out planning units [45 locked units]&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (0)]</code></pre>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem</span>
<span class="va">s4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p4</span><span class="op">)</span>

<span class="co"># plot solution</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/spplot.html">spplot</a></span><span class="op">(</span><span class="va">s4</span>, <span class="st">"solution_1"</span>, col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"s4"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-74-1.png" width="65%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_solution</span><span class="op">(</span><span class="va">s4</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-74-2.png" width="65%" style="display: block; margin: auto;"></div>
<p>Now, let’s compare the solutions.</p>

<div class="rmdquestion">
<ol style="list-style-type: decimal">
<li>What is the cost of the planning units selected in <code>s2</code>, <code>s3</code>, and <code>s4</code>?</li>
<li>How many planning units are in <code>s2</code>, <code>s3</code>, and <code>s4</code>?</li>
<li>Do the solutions with more planning units have a greater cost? Why or why not?</li>
<li>Why does the first solution (<code>s1</code>) cost less than the second solution with protected areas locked into the solution (<code>s2</code>)?</li>
<li>Why does the third solution (<code>s3</code>) cost less than the fourth solution solution with highly degraded areas locked out (<code>s4</code>)?</li>
<li>Since planning units covered by existing protected areas have already been purchased, what is the cost for expanding the protected area system based on on the fourth prioritization (<code>s4</code>) (hint: total cost minus the cost of locked in planning units)?</li>
<li>What happens if you specify targets that exceed the total amount of vegetation in the study area and try to solve the problem? You can do this by modifying the code to make <code>p4</code> with <code><a href="https://prioritizr.net/reference/add_absolute_targets.html">add_absolute_targets(1000)</a></code> instead of <code><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets(0.2)</a></code> and generating a new solution.</li>
</ol>
</div>
</div>
<div id="penalizing-fragmentation" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Penalizing fragmentation<a class="anchor" aria-label="anchor" href="#penalizing-fragmentation"><i class="fas fa-link"></i></a>
</h2>
<p>Plans for protected area systems should facilitate gene flow and dispersal between individual reserves in the system. However, the prioritizations we have made so far have been highly fragmented.</p>
<p>We can add penalties to our conservation planning problem to penalize fragmentation (i.e. total exposed boundary length) and we also need to set a useful penalty value when adding such penalties. If we set our penalty value too low, then we will end up with a solution that is identical to the solution with no added penalties. If we set our penalty value too high, then prioritizr will take a long time to solve the problem and we will end up with a solution that contains lots of extra planning units that are not needed (since the penalty value is so high that minimizing fragmentation is more important than cost). As a rule of thumb, we generally want penalty values between 0.00001 and 0.01 but finding a useful penalty value requires calibration. The “correct” penalty value depends on the size of the planning units, the main objective values (e.g. cost values), and the effect of fragmentation on biodiversity persistence.</p>
<p>Let’s create a new problem that is similar to our previous problem (<code>p4</code>)—except that it contains boundary length penalties and a slightly higher optimality gap to reduce runtime (default is 0.1)—and solve it. Since our planning unit data is in a spatial format (i.e. vector or raster data), prioritizr can automatically calculate the boundary data for us.</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make prioritization problem</span>
<span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_boundary_penalties.html">add_boundary_penalties</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fl">0.0005</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_out_constraints.html">add_locked_out_constraints</a></span><span class="op">(</span><span class="st">"locked_out"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = FALSE)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p5</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Minimum set objective 
##   targets:        Relative targets [targets (min: 0.2, max: 0.2)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]
##                    Locked out planning units [45 locked units]&gt;
##   penalties:      &lt;Boundary penalties [edge factor (min: 0.5, max: 0.5), penalty (5e-04), zones]&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (0)]</code></pre>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem,</span>
<span class="co"># note this will take around 30 seconds</span>
<span class="va">s5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p5</span><span class="op">)</span>

<span class="co"># print solution</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">s5</span><span class="op">)</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1130 
## extent      : 1080623, 1399989, -4840595, -4497092  (xmin, xmax, ymin, ymax)
## crs         : +proj=aea +lat_0=0 +lon_0=132 +lat_1=-18 +lat_2=-36 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## variables   : 6
## names       :   id,              cost, status, locked_in, locked_out, solution_1 
## min values  :    1, 0.192488262910798,      0,         0,          0,          0 
## max values  : 1130,  61.9272727272727,      2,         1,          1,          1</code></pre>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot solution</span>
<span class="fu">plot_solution</span><span class="op">(</span><span class="va">s5</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-76-1.png" width="65%" style="display: block; margin: auto;"></div>
<p>Now let’s compare the solutions to the problems with (<code>s5</code>) and without (<code>s4</code>) the boundary length penalties.</p>

<div class="rmdquestion">
<ol style="list-style-type: decimal">
<li>What is the cost the fourth (<code>s4</code>) and fifth (<code>s5</code>) solutions? Why does the fifth solution (<code>s5</code>) cost more than the fourth (<code>s4</code>) solution?</li>
<li>Try setting the penalty value to 0.000000001 (i.e. <code>1e-9</code>) instead of 0.0005. What is the cost of the solution now? Is it different from the fourth solution (<code>s4</code>) (hint: try plotting the solutions to visualize them)? Is this is a useful penalty value? Why?</li>
<li>Try setting the penalty value to 0.5. What is the cost of the solution now? Is it different from the fourth solution (<code>s4</code>) (hint: try plotting the solutions to visualize them)? Is this a useful penalty value? Why?</li>
</ol>
</div>
</div>
<div id="budget-limited-prioritizations" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Budget limited prioritizations<a class="anchor" aria-label="anchor" href="#budget-limited-prioritizations"><i class="fas fa-link"></i></a>
</h2>
<p>In the real-world, the funding available for conservation is often very limited. As a consequence, decision makers often need prioritizations where the total cost of priority areas does not exceed a budget.</p>
<p>In our fourth prioritization (<code>s4</code>), we found that we would need to spend an additional $1317 million AUD to ensure that each vegetation community is adequately represented in the protected area system. But what if the funds available for establishing new protected areas were limited to $100 million AUD? In this case, we need a “budget limited prioritization”. Budget limited prioritizations aim to maximize some measure of conservation benefit subject to a budget (e.g. <a href="https://prioritizr.net/reference/add_max_cover_objective.html">number of species with at least one occurrence in the protected area system</a>, or <a href="https://prioritizr.net/reference/add_max_phylo_div_objective.html">phylogenetic diversity</a>). Let’s create a prioritization by maximizing the number of adequately represented features whilst keeping within a pre-specified budget.</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># funds for additional land acquisition (same units as cost data)</span>
<span class="va">funds</span> <span class="op">&lt;-</span> <span class="fl">100</span>

<span class="co"># calculate the total budget for the prioritization</span>
<span class="va">budget</span> <span class="op">&lt;-</span> <span class="va">funds</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">s4</span><span class="op">$</span><span class="va">cost</span> <span class="op">*</span> <span class="va">s4</span><span class="op">$</span><span class="va">locked_in</span><span class="op">)</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">budget</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 8575.56</code></pre>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make prioritization problem</span>
<span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_max_features_objective.html">add_max_features_objective</a></span><span class="op">(</span><span class="va">budget</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_out_constraints.html">add_locked_out_constraints</a></span><span class="op">(</span><span class="st">"locked_out"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = FALSE)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Maximum representation objective [budget (8575.56009869836)]
##   targets:        Relative targets [targets (min: 0.2, max: 0.2)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked out planning units [45 locked units]
##                    Locked in planning units [257 locked units]&gt;
##   penalties:      &lt;none&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (0)]</code></pre>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem</span>
<span class="va">s6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span>

<span class="co"># plot solution</span>
<span class="fu">plot_solution</span><span class="op">(</span><span class="va">s6</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/budget-1.png" width="65%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate feature representation</span>
<span class="va">r6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/eval_feature_representation_summary.html">eval_feature_representation_summary</a></span><span class="op">(</span><span class="va">p6</span>, <span class="va">s6</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span>

<span class="co"># calculate number of features with targets met</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">r6</span><span class="op">$</span><span class="va">relative_held</span> <span class="op">&gt;=</span> <span class="fl">0.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 28</code></pre>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find out which features have their targets met when we add weights,</span>
<span class="co"># note that NA is for vegetation.61</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">r6</span><span class="op">$</span><span class="va">feature</span><span class="op">[</span><span class="va">r6</span><span class="op">$</span><span class="va">relative_held</span> <span class="op">&gt;=</span> <span class="fl">0.2</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "vegetation.1"  "vegetation.2"  "vegetation.3"  "vegetation.4"  "vegetation.5"  "vegetation.6"  "vegetation.7"  "vegetation.8" 
##  [9] "vegetation.11" "vegetation.12" "vegetation.15" "vegetation.17" "vegetation.22" "vegetation.23" "vegetation.25" "vegetation.28"
## [17] "vegetation.29" "vegetation.30" "vegetation.32" "vegetation.33" "vegetation.34" "vegetation.35" "vegetation.36" "vegetation.37"
## [25] "vegetation.38" "vegetation.39" "vegetation.40" "vegetation.45"</code></pre>
<p>We can also add weights to specify that it is more important to meet the targets for certain features and less important for other features. A common approach for weighting features is to assign a greater importance to features with smaller spatial distributions. The rationale behind this weighting method is that features with smaller spatial distributions are at greater risk of extinction.</p>
<p>So, let’s calculate some weights for our vegetation communities and see how weighting the features changes our prioritization.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate weights as the log inverse number of grid cells that each vegetation</span>
<span class="co"># class occupies, rescaled between 1 and 100</span>
<span class="va">wts</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span><span class="op">(</span><span class="va">tas_features</span>, <span class="st">"sum"</span><span class="op">)</span>
<span class="va">wts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://scales.r-lib.org//reference/rescale.html">rescale</a></span><span class="op">(</span><span class="va">wts</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># print the name of the feature with smallest weight</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">tas_features</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/which.minmax.html">which.min</a></span><span class="op">(</span><span class="va">wts</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] "vegetation.20"</code></pre>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print the name of the feature with greatest weight</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">tas_features</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/which.minmax.html">which.max</a></span><span class="op">(</span><span class="va">wts</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>## [1] "vegetation.52"</code></pre>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot histogram of weights</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html">hist</a></span><span class="op">(</span><span class="va">wts</span>, main <span class="op">=</span> <span class="st">"feature weights"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/budget-weights-1.png" width="65%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make prioritization problem with weights</span>
<span class="va">p7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_max_features_objective.html">add_max_features_objective</a></span><span class="op">(</span><span class="va">budget</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_feature_weights.html">add_feature_weights</a></span><span class="op">(</span><span class="va">wts</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_in_constraints.html">add_locked_in_constraints</a></span><span class="op">(</span><span class="st">"locked_in"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_locked_out_constraints.html">add_locked_out_constraints</a></span><span class="op">(</span><span class="st">"locked_out"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
       <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = FALSE)</span>

<span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p7</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Maximum representation objective [budget (8575.56009869836)]
##   targets:        Relative targets [targets (min: 0.2, max: 0.2)]
##   decisions:      Binary decision 
##   constraints:    &lt;Locked in planning units [257 locked units]
##                    Locked out planning units [45 locked units]&gt;
##   penalties:      &lt;Feature weights [weights (min: 1, max: 10)]&gt;
##   portfolio:      default
##   solver:         Gurobi [first_feasible (0), gap (0.1), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (0)]</code></pre>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem</span>
<span class="va">s7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p7</span><span class="op">)</span>

<span class="co"># plot solution</span>
<span class="fu">plot_solution</span><span class="op">(</span><span class="va">s7</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/budget-weights-2.png" width="65%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate feature representation</span>
<span class="va">r7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/eval_feature_representation_summary.html">eval_feature_representation_summary</a></span><span class="op">(</span><span class="va">p7</span>, <span class="va">s7</span><span class="op">[</span>, <span class="st">"solution_1"</span><span class="op">]</span><span class="op">)</span>

<span class="co"># calculate number of features with targets met</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">r7</span><span class="op">$</span><span class="va">relative_held</span> <span class="op">&gt;=</span> <span class="fl">0.2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 22</code></pre>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find out which features have their targets met when we add weights,</span>
<span class="co"># note that NA is for vegetation.61</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">r7</span><span class="op">$</span><span class="va">feature</span><span class="op">[</span><span class="va">r7</span><span class="op">$</span><span class="va">relative_held</span> <span class="op">&gt;=</span> <span class="fl">0.2</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "vegetation.2"  "vegetation.6"  "vegetation.11" "vegetation.23" "vegetation.28" "vegetation.29" "vegetation.30" "vegetation.32"
##  [9] "vegetation.33" "vegetation.34" "vegetation.35" "vegetation.36" "vegetation.37" "vegetation.38" "vegetation.39" "vegetation.40"
## [17] "vegetation.45" "vegetation.49" "vegetation.50" "vegetation.52" "vegetation.53" "vegetation.61"</code></pre>

<div class="rmdquestion">
<ol style="list-style-type: decimal">
<li>What is the name of the feature with the smallest weight?</li>
<li>What is the cost of the sixth (<code>s6</code>) and seventh (<code>s7</code>) solutions?</li>
<li>Does there seem to be a big difference in which planning units were selected in the sixth (<code>s6</code>) and seventh (<code>s7</code>) solutions?</li>
<li>Is there a difference between which features are adequately represented in the sixth (<code>s6</code>) and seventh (<code>s7</code>) solutions? If so, what is the difference?</li>
</ol>
</div>
</div>
<div id="solution-portfolios" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> Solution portfolios<a class="anchor" aria-label="anchor" href="#solution-portfolios"><i class="fas fa-link"></i></a>
</h2>
<p>In systematic conservation planning, only rarely do we have data on all of the stakeholder preferences and biodiversity features that we are interested in conserving. As a consequence, it is often useful to generate a portfolio of near optimal solutions to present to decision makers to guide the reserve selection process.</p>
<p>Generally we would want many solutions in our portfolio (e.g. 1000) to ensure that our portfolio contains a range of spatially distinct solutions, but here we will generate a portfolio containing just six near-optimal solutions so the code doesn’t take too long to run. We will also increase the optimality gap to obtain solutions that are more suboptimal than earlier (the default gap value is 0.1).</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make problem with a shuffle portfolio</span>
<span class="va">p8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/problem.html">problem</a></span><span class="op">(</span><span class="va">tas_pu</span>, <span class="va">tas_features</span>, cost_column <span class="op">=</span> <span class="st">"cost"</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_max_features_objective.html">add_max_features_objective</a></span><span class="op">(</span><span class="va">budget</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_feature_weights.html">add_feature_weights</a></span><span class="op">(</span><span class="va">wts</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_shuffle_portfolio.html">add_shuffle_portfolio</a></span><span class="op">(</span>number_solutions <span class="op">=</span> <span class="fl">6</span>,
                            remove_duplicates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu"><a href="https://prioritizr.net/reference/add_gurobi_solver.html">add_gurobi_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span>, gap <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
      <span class="co"># add_lpsymphony_solver(verbose = TRUE, gap = 10)</span></code></pre></div>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print problem</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">p8</span><span class="op">)</span></code></pre></div>
<pre><code>## Conservation Problem
##   planning units: SpatialPolygonsDataFrame (1130 units)
##   cost:           min: 0.19249, max: 61.92727
##   features:       vegetation.1, vegetation.2, vegetation.3, ... (62 features)
##   objective:      Maximum representation objective [budget (8575.56009869836)]
##   targets:        Relative targets [targets (min: 0.2, max: 0.2)]
##   decisions:      Binary decision 
##   constraints:    &lt;none&gt;
##   penalties:      &lt;Feature weights [weights (min: 1, max: 10)]&gt;
##   portfolio:      Shuffle portfolio [number_solutions (6), remove_duplicates (0), threads (1)]
##   solver:         Gurobi [first_feasible (0), gap (10), numeric_focus (0), presolve (2), threads (1), time_limit (2147483647), verbose (1)]</code></pre>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># solve problem</span>
<span class="co"># note that this will contain six solutions since we added a portfolio</span>
<span class="va">s8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://prioritizr.net/reference/solve.html">solve</a></span><span class="op">(</span><span class="va">p8</span><span class="op">)</span></code></pre></div>
<pre><code>## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 63 rows, 1192 columns and 3308 nonzeros
## Model fingerprint: 0x0e2ebd61
## Variable types: 0 continuous, 1192 integer (1192 binary)
## Coefficient statistics:
##   Matrix range     [1e-05, 2e+02]
##   Objective range  [7e-08, 1e+01]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [9e+03, 9e+03]
## Found heuristic solution: objective -0.0000000
## Presolve removed 0 rows and 143 columns
## Presolve time: 0.02s
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## Variable types: 0 continuous, 1049 integer (1049 binary)
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## 
## 
## Root relaxation: objective 1.319894e+02, 63 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  131.98943    0   51   -0.00000  131.98943      -     -    0s
## H    0     0                      77.7382485  131.98943  69.8%     -    0s
## 
## Explored 1 nodes (63 simplex iterations) in 0.02 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 2: 77.7382 -0 
## 
## Optimal solution found (tolerance 1.00e+01)
## Best objective 7.773824845163e+01, best bound 1.319894286177e+02, gap 69.7870%
## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 63 rows, 1192 columns and 3308 nonzeros
## Model fingerprint: 0x367d2c23
## Variable types: 0 continuous, 1192 integer (1192 binary)
## Coefficient statistics:
##   Matrix range     [1e-05, 2e+02]
##   Objective range  [7e-08, 1e+01]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [9e+03, 9e+03]
## Found heuristic solution: objective -0.0000000
## Presolve removed 0 rows and 143 columns
## Presolve time: 0.02s
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## Variable types: 0 continuous, 1049 integer (1049 binary)
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## 
## 
## Root relaxation: objective 1.319894e+02, 67 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  131.98943    0   51   -0.00000  131.98943      -     -    0s
## H    0     0                      89.3624065  131.98943  47.7%     -    0s
## 
## Explored 1 nodes (67 simplex iterations) in 0.02 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 2: 89.3624 -0 
## 
## Optimal solution found (tolerance 1.00e+01)
## Best objective 8.936240649820e+01, best bound 1.319894284204e+02, gap 47.7013%
## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 63 rows, 1192 columns and 3308 nonzeros
## Model fingerprint: 0x9ccd284f
## Variable types: 0 continuous, 1192 integer (1192 binary)
## Coefficient statistics:
##   Matrix range     [1e-05, 2e+02]
##   Objective range  [7e-08, 1e+01]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [9e+03, 9e+03]
## Found heuristic solution: objective -0.0000000
## Presolve removed 0 rows and 143 columns
## Presolve time: 0.02s
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## Variable types: 0 continuous, 1049 integer (1049 binary)
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## 
## 
## Root relaxation: objective 1.319894e+02, 66 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  131.98943    0   50   -0.00000  131.98943      -     -    0s
## H    0     0                      83.7623274  131.98943  57.6%     -    0s
## 
## Explored 1 nodes (66 simplex iterations) in 0.02 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 2: 83.7623 -0 
## 
## Optimal solution found (tolerance 1.00e+01)
## Best objective 8.376232739782e+01, best bound 1.319894282434e+02, gap 57.5761%
## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 63 rows, 1192 columns and 3308 nonzeros
## Model fingerprint: 0x078e8de4
## Variable types: 0 continuous, 1192 integer (1192 binary)
## Coefficient statistics:
##   Matrix range     [1e-05, 2e+02]
##   Objective range  [7e-08, 1e+01]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [9e+03, 9e+03]
## Found heuristic solution: objective -0.0000000
## Presolve removed 0 rows and 143 columns
## Presolve time: 0.02s
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## Variable types: 0 continuous, 1049 integer (1049 binary)
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## 
## 
## Root relaxation: objective 1.319894e+02, 63 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  131.98943    0   51   -0.00000  131.98943      -     -    0s
## H    0     0                      84.2490140  131.98943  56.7%     -    0s
## 
## Explored 1 nodes (63 simplex iterations) in 0.02 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 2: 84.249 -0 
## 
## Optimal solution found (tolerance 1.00e+01)
## Best objective 8.424901402314e+01, best bound 1.319894286177e+02, gap 56.6658%
## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 63 rows, 1192 columns and 3308 nonzeros
## Model fingerprint: 0x701b1d8e
## Variable types: 0 continuous, 1192 integer (1192 binary)
## Coefficient statistics:
##   Matrix range     [1e-05, 2e+02]
##   Objective range  [7e-08, 1e+01]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [9e+03, 9e+03]
## Found heuristic solution: objective -0.0000000
## Presolve removed 0 rows and 143 columns
## Presolve time: 0.02s
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## Variable types: 0 continuous, 1049 integer (1049 binary)
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## 
## 
## Root relaxation: objective 1.319894e+02, 63 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  131.98943    0   51   -0.00000  131.98943      -     -    0s
## H    0     0                      82.2654324  131.98943  60.4%     -    0s
## 
## Explored 1 nodes (63 simplex iterations) in 0.02 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 2: 82.2654 -0 
## 
## Optimal solution found (tolerance 1.00e+01)
## Best objective 8.226543241139e+01, best bound 1.319894285790e+02, gap 60.4434%
## Gurobi Optimizer version 9.1.1 build v9.1.1rc0 (mac64)
## Thread count: 4 physical cores, 8 logical processors, using up to 1 threads
## Optimize a model with 63 rows, 1192 columns and 3308 nonzeros
## Model fingerprint: 0xde8243b0
## Variable types: 0 continuous, 1192 integer (1192 binary)
## Coefficient statistics:
##   Matrix range     [1e-05, 2e+02]
##   Objective range  [7e-08, 1e+01]
##   Bounds range     [1e+00, 1e+00]
##   RHS range        [9e+03, 9e+03]
## Found heuristic solution: objective -0.0000000
## Presolve removed 0 rows and 143 columns
## Presolve time: 0.02s
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## Variable types: 0 continuous, 1049 integer (1049 binary)
## Presolved: 63 rows, 1049 columns, 3152 nonzeros
## 
## 
## Root relaxation: objective 1.319894e+02, 63 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  131.98943    0   51   -0.00000  131.98943      -     -    0s
## H    0     0                      82.2064634  131.98943  60.6%     -    0s
## 
## Explored 1 nodes (63 simplex iterations) in 0.02 seconds
## Thread count was 1 (of 8 available processors)
## 
## Solution count 2: 82.2065 -0 
## 
## Optimal solution found (tolerance 1.00e+01)
## Best objective 8.220646336687e+01, best bound 1.319894285520e+02, gap 60.5585%</code></pre>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print solution</span>
<span class="fu"><a href="https://prioritizr.net/reference/print.html">print</a></span><span class="op">(</span><span class="va">s8</span><span class="op">)</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 1130 
## extent      : 1080623, 1399989, -4840595, -4497092  (xmin, xmax, ymin, ymax)
## crs         : +proj=aea +lat_0=0 +lon_0=132 +lat_1=-18 +lat_2=-36 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs 
## variables   : 11
## names       :   id,              cost, status, locked_in, locked_out, solution_1, solution_2, solution_3, solution_4, solution_5, solution_6 
## min values  :    1, 0.192488262910798,      0,         0,          0,          0,          0,          0,          0,          0,          0 
## max values  : 1130,  61.9272727272727,      2,         1,          1,          1,          1,          1,          1,          1,          1</code></pre>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate the cost of the first solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_1</span> <span class="op">*</span> <span class="va">s8</span><span class="op">$</span><span class="va">cost</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 680.883</code></pre>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate the cost of the second solution</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_2</span> <span class="op">*</span> <span class="va">s8</span><span class="op">$</span><span class="va">cost</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 746.614</code></pre>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># calculate the proportion of planning units with the same solution values</span>
<span class="co"># in the first and second solutions</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_1</span> <span class="op">==</span> <span class="va">s8</span><span class="op">$</span><span class="va">solution_2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.9876106</code></pre>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot first solution</span>
<span class="fu">plot_solution</span><span class="op">(</span><span class="va">s8</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-82-1.png" width="65%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot all solutions</span>
<span class="co"># s8_plots &lt;- lapply(paste0("solution_", seq_len(6)), function(x) {</span>
<span class="co">#   spplot(s8, x, main = x, col.regions = c("white", "darkgreen"))</span>
<span class="co"># })</span>
<span class="co"># do.call(grid.arrange, append(s8_plots, list(ncol = 3)))</span>

<span class="va">s8</span><span class="op">$</span><span class="va">solution_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_1</span><span class="op">)</span>
<span class="va">s8</span><span class="op">$</span><span class="va">solution_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_2</span><span class="op">)</span>
<span class="va">s8</span><span class="op">$</span><span class="va">solution_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_3</span><span class="op">)</span>
<span class="va">s8</span><span class="op">$</span><span class="va">solution_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_4</span><span class="op">)</span>
<span class="va">s8</span><span class="op">$</span><span class="va">solution_5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_5</span><span class="op">)</span>
<span class="va">s8</span><span class="op">$</span><span class="va">solution_6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">s8</span><span class="op">$</span><span class="va">solution_6</span><span class="op">)</span>

<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">s8</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"solution_1"</span>, <span class="st">"solution_2"</span>, <span class="st">"solution_3"</span>, <span class="st">"solution_4"</span>, <span class="st">"solution_5"</span>, <span class="st">"solution_6"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
  pal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey90"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="SpatialPlanning_Workshop2021_files/figure-html/unnamed-chunk-83-1.png" width="768" style="display: block; margin: auto;"></div>

<div class="rmdquestion">
<ol style="list-style-type: decimal">
<li>What is the cost of each of the six solutions in portfolio? Are their costs very different?</li>
<li>Are the solutions in the portfolio very different?</li>
<li>What could we do to obtain a portfolio with more different solutions?</li>
</ol>
</div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="data.html"><span class="header-section-number">5</span> Spatial Data</a></div>
<div class="next"><a href="acknowledgements.html"><span class="header-section-number">7</span> Acknowledgements</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#spatial-prioritizations"><span class="header-section-number">6</span> Spatial prioritizations</a></li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">6.1</span> Introduction</a></li>
<li><a class="nav-link" href="#starting-out-simple"><span class="header-section-number">6.2</span> Starting out simple</a></li>
<li><a class="nav-link" href="#adding-complexity"><span class="header-section-number">6.3</span> Adding complexity</a></li>
<li><a class="nav-link" href="#penalizing-fragmentation"><span class="header-section-number">6.4</span> Penalizing fragmentation</a></li>
<li><a class="nav-link" href="#budget-limited-prioritizations"><span class="header-section-number">6.5</span> Budget limited prioritizations</a></li>
<li><a class="nav-link" href="#solution-portfolios"><span class="header-section-number">6.6</span> Solution portfolios</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>2021 UQ Spatial Planning Workshop using Prioritizr</strong>" was written by Jason D. Everett, Isaac Brito-Morales. It was last built on 2021-02-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
